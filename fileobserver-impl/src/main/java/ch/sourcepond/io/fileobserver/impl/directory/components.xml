<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

    <bean id="directory.roots" class="java.util.concurrent.CopyOnWriteArrayList"/>

    <bean id="directory.fsDirectoryFactory" class="ch.sourcepond.io.fileobserver.impl.directory.FsDirectoryFactory">
        <argument ref="OSGi_service.resourceFactory"/>
        <argument ref="filekey.defaultFileKeyFactory"/>
        <argument ref="observerExecutor"/>
    </bean>

    <bean id="directory.fsDirectoriesFactory"
          class="ch.sourcepond.io.fileobserver.impl.directory.FsDirectoriesFactory"/>

    <bean id="directory.directoryScanner" class="ch.sourcepond.io.fileobserver.impl.directory.DirectoryScanner"
          destroy-method="close">
        <argument ref="directory.roots"/>
        <argument ref="directory.directories"/>
    </bean>

    <bean id="directory.directories" class="ch.sourcepond.io.fileobserver.impl.directory.Directories">
        <argument ref="registrar.registrarFactory" />
        <argument ref="directory.fsDirectoriesFactory" />
        <argument ref="observerExecutor" />
        <argument ref="directory.roots" />
    </bean>

</blueprint>